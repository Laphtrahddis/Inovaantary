<main class="flex flex-1 justify-center px-40 py-5">
  <div class="layout-content-container flex max-w-[960px] flex-1 flex-col">
    <div class="flex flex-wrap justify-between gap-3 p-4">
      <p class="min-w-72 text-[32px] font-bold leading-tight tracking-light text-[#0d161c]">Inventory Records</p>
    </div>
    <div class="flex flex-wrap gap-4 p-4">
      <div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl border border-[#cedee8] p-6">
  <p class="text-base font-medium leading-normal text-[#0d161c]">Total Items</p>
  <p class="text-2xl font-bold leading-tight tracking-light text-[#0d161c]">{{ totalItems }}</p>
</div>
<div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl border border-[#cedee8] p-6">
  <p class="text-base font-medium leading-normal text-[#0d161c]">Total Value</p>
  <p class="text-2xl font-bold leading-tight tracking-light text-[#0d161c]">{{ totalValue | currency:'USD' }}</p>
</div>
<div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl border border-[#cedee8] p-6">
  <p class="text-base font-medium leading-normal text-[#0d161c]">Categories</p>
  <p class="text-2xl font-bold leading-tight tracking-light text-[#0d161c]">{{ categoryCount }}</p>
</div>
    </div>
    <div class="px-4 py-3">
  <!-- Container for the search bar and filter button -->
  <div class="flex items-center space-x-4">
    
    <!-- Search Bar (takes up most of the space) -->
    <label class="flex h-12 w-full min-w-40 flex-col flex-1">
      <div class="flex h-full w-full flex-1 items-stretch rounded-xl">
        <div class="flex items-center justify-center rounded-l-xl border-r-0 border-none bg-[#e7eef4] pl-4 text-[#497b9c]">
          <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
            <path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>
          </svg>
        </div>
        <input (input)="onSearch($event)" placeholder="Search items by name or category" class="form-input h-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl rounded-l-none border-l-0 border-none bg-[#e7eef4] px-4 pl-2 text-base font-normal leading-normal text-[#0d161c] placeholder:text-[#497b9c] focus:border-none focus:outline-0 focus:ring-0" />
      </div>
    </label>

    <!-- Filter Button -->
    <button (click)="toggleFilter()" class="flex-shrink-0 h-12 px-5 rounded-xl bg-[#e7eef4] hover:bg-[#dbe3eb] text-sm font-bold text-[#0d161c]">
      Filter & Sort
    </button>
  </div>

  <!-- Floating Filter Panel (appears when isFilterOpen is true) -->
  @if (isFilterOpen) {
    <div class="mt-3 border rounded-xl bg-slate-50 p-4">
      <form [formGroup]="filterForm" (ngSubmit)="applyFilters()" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
        <!-- Min Price -->
        <div>
          <label for="min_price" class="text-sm font-medium">Min Price</label>
          <input id="min_price" type="number" formControlName="min_price" class="w-full p-2 border rounded mt-1 bg-white">
        </div>
        <!-- Max Price -->
        <div>
          <label for="max_price" class="text-sm font-medium">Max Price</label>
          <input id="max_price" type="number" formControlName="max_price" class="w-full p-2 border rounded mt-1 bg-white">
        </div>
        <!-- Sort By -->
        <div>
          <label for="sort_by" class="text-sm font-medium">Sort By</label>
          <select id="sort_by" formControlName="sort_by" class="w-full p-2 border rounded bg-white mt-1">
            <option value="price">Price</option>
            <option value="quantity">Quantity</option>
            <option value="dateAdded">Date Added</option>
          </select>
        </div>
         <!-- Sort Order & Apply Button -->
        <div class="flex space-x-2">
          <select formControlName="sort_order" class="w-full p-2 border rounded bg-white">
            <option [ngValue]="1">Low to High</option>
            <option [ngValue]="-1">High to Low</option>
          </select>
          <button type="submit" class="h-10 px-4 rounded-lg bg-blue-600 text-white font-bold hover:bg-blue-700">Done</button>
        </div>
      </form>
    </div>
  }
</div>
   
    <div class="px-4 py-3 @container">
      <div class="flex overflow-hidden rounded-xl border border-[#cedee8] bg-slate-50">
        <table class="w-full flex-1">
          <thead>
            <tr class="bg-slate-50">
              <th class="w-[400px] px-4 py-3 text-left text-sm font-medium leading-normal text-[#0d161c]">S.No</th>
              <th class="w-[400px] px-4 py-3 text-left text-sm font-medium leading-normal text-[#0d161c]">Item Name</th>
              <th class="w-[400px] px-4 py-3 text-left text-sm font-medium leading-normal text-[#0d161c]">Category</th>
              <th class="w-[400px] px-4 py-3 text-left text-sm font-medium leading-normal text-[#0d161c]">Date Added</th>
              <th class="w-[400px] px-4 py-3 text-left text-sm font-medium leading-normal text-[#0d161c]">Price</th>
              <th class="w-[400px] px-4 py-3 text-left text-sm font-medium leading-normal text-[#0d161c]">Count</th>
              <th class="w-[400px] px-4 py-3 text-left text-sm font-medium leading-normal text-[#0d161c]">Edit</th>
              <th class="w-[400px] px-4 py-3 text-left text-sm font-medium leading-normal text-[#0d161c]">Delete</th>
            </tr>
          </thead>
          <tbody>
            @for (it of items; track it; let i = $index) {
            <tr class="border-t border-t-[#cedee8]">
              <td class="h-[72px] w-[400px] px-4 py-2 align-middle text-sm font-normal leading-normal text-[#0d161c]">{{ i+1 }}</td>
              <td class="h-[72px] w-[400px] px-4 py-2 align-middle text-sm font-normal leading-normal text-[#0d161c]">{{ it.productName }}</td>
              <td class="h-[72px] w-[400px] px-4 py-2 align-middle text-sm font-normal leading-normal text-[#497b9c]">{{ it.category }}</td>
              <td class="h-[72px] w-[400px] px-4 py-2 align-middle text-sm font-normal leading-normal text-[#497b9c]">{{ it.dateAdded | date:'yyyy-MM-dd' }}</td>
              <td class="h-[72px] w-[400px] px-4 py-2 align-middle text-sm font-normal leading-normal text-[#497b9c]">${{ it.price }}</td>
              <td class="h-[72px] w-60 px-4 py-2 align-middle">
  <div class="flex items-center space-x-2">
    <button (click)="decrementQuantity(it)" [disabled]="it.quantity <= 1" class="px-2 py-0.5 border rounded disabled:opacity-50">-</button>
    <span>{{ it.quantity }}</span>
    <button (click)="incrementQuantity(it)" class="px-2 py-0.5 border rounded">+</button>
  </div>
</td>
              <td class="h-[72px] w-60 px-4 py-2 align-middle text-sm font-bold leading-normal tracking-[0.015em]"> 
                  <a [routerLink]="['/edit-item', it._id]" class="text-blue-600 hover:underline cursor-pointer">Edit</a>
              </td>
              <td (click)="openDeleteDialog(it)" class="h-[72px] w-60 px-4 py-2 align-middle text-sm font-bold leading-normal tracking-[0.015em]"> 
                  <a class="text-blue-600 hover:underline cursor-pointer">Delete</a>
              </td>
              
            </tr>
            } @empty {
            <tr class="border-t border-t-[#cedee8]">
              <td colspan="6" class="h-[72px] px-4 py-2 text-center text-sm font-normal leading-normal text-[#497b9c]">
                No inventory records found.
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    <div class="flex items-center justify-center p-4">
  <button (click)="previousPage()" [disabled]="currentPage === 1" class="flex size-10 items-center justify-center disabled:opacity-50">
    <div class="text-[#0d161c]" data-icon="CaretLeft" data-size="18px" data-weight="regular">
      <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256">
        <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
      </svg>
    </div>
  </button>
  
  <span class="p-4 text-sm font-medium">Page {{ currentPage }}</span>

  <button (click)="nextPage()" [disabled]="items.length < itemsPerPage" class="flex size-10 items-center justify-center disabled:opacity-50">
    <div class="text-[#0d161c]" data-icon="CaretRight" data-size="18px" data-weight="regular">
      <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256">
        <path d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z"></path>
      </svg>
    </div>
  </button>
</div>

  </div>
  @if (isDialogOpen && itemToDelete) {
  <app-delete-confirm-dialog 
    [itemName]="itemToDelete.productName"
    (confirm)="onConfirmDelete()"
    (close)="closeDeleteDialog()">
  </app-delete-confirm-dialog>
}
</main>